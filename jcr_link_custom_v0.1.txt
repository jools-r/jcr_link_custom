# Name: jcr_link_custom v0.1 
# Type: Admin/Public plugin
# Adds a custom field to the links panel
# Author: jcr / txpbuilders
# URL: http://txp.builders
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxNTp7czo0OiJuYW1lIjtzOjE1OiJqY3JfbGlua19jdXN0b20iO3M6NzoidmVyc2lvbiI7
czozOiIwLjEiO3M6ODoicmV2aXNpb24iO3M6MDoiIjtzOjY6ImF1dGhvciI7czoxNzoiamNy
IC8gdHhwYnVpbGRlcnMiO3M6MTA6ImF1dGhvcl91cmkiO3M6MTk6Imh0dHA6Ly90eHAuYnVp
bGRlcnMiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjM4OiJBZGRzIGEgY3VzdG9tIGZpZWxkIHRv
IHRoZSBsaW5rcyBwYW5lbCI7czo1OiJvcmRlciI7czoxOiI1IjtzOjQ6InR5cGUiO3M6MToi
MSI7czo1OiJmbGFncyI7czowOiIiO3M6ODoidGV4dHBhY2siO3M6OTc6IiNAYWRtaW4KI0Bs
YW5ndWFnZSBlbi1nYgpqY3JfbGlua19jdXN0b20gPT4gSW1hZ2UgSUQKI0BsYW5ndWFnZSBk
ZS1kZQpqY3JfbGlua19jdXN0b20gPT4gQmlsZCBJRAoiO3M6MTA6ImxvYWRfb3JkZXIiO3M6
MToiNSI7czo0OiJoZWxwIjtzOjI5MTM6IjxoMT5qY3JfbGlua19jdXN0b208L2gxPgoKPHA+
QWRkcyBhIHNpbmdsZSBleHRyYSBjdXN0b20gZmllbGQgb2YgdXAgdG8gMjU1IGNoYXJhY3Rl
cnMgdG8gdGhlIDxhIGhyZWY9Imh0dHA6Ly9kb2NzLnRleHRwYXR0ZXJuLmlvL2FkbWluaXN0
cmF0aW9uL2xpbmtzLXBhbmVsIj5Db250ZW50IOKAuiBMaW5rczwvYT4gcGFuZWwgYW5kIHBy
b3ZpZGVzIGEgY29ycmVzcG9uZGluZyB0YWcgdG8gb3V0cHV0IHRoZSBjdXN0b20gZmllbGQu
PC9wPgoKCjxoMj5Vc2UgY2FzZXM8L2gyPgoKPHA+VXNlIHdoZW5ldmVyIGV4dHJhIGluZm9y
bWF0aW9uIG5lZWRzIHRvIGJlIHN0b3JlZCB3aXRoIGEgbGluay4gRm9yIGV4YW1wbGU6PC9w
PgoKPHVsPgoJPGxpPlN0b3JlIGEgdHhwIGltYWdlIElEIG51bWJlciBhbmQgdXNlIGl0IHRv
IGF0dGFjaCBhIGxvZ28gdG8gYSBsaW5rLjwvbGk+Cgk8bGk+U3RvcmUgYXNzb2NpYXRlZCBk
ZXRhaWxzLCBmb3IgZXhhbXBsZSB0aGUgbG9jYXRpb24gb2YgYSBsaW5rZWQgb3JnYW5pc2F0
aW9uLjwvbGk+Cgk8bGk+4oCmPC9saT4KPC91bD4KCgo8aDIgaWQ9Imluc3RhbGxhdGlvbiI+
SW5zdGFsbGF0aW9uPC9oMj4KCjxwPlBhc3RlIHRoZSBjb2RlIGludG8gdGhlICA8ZW0+QWRt
aW4g4oC6IFBsdWdpbnM8L2VtPiBwYW5lbCwgaW5zdGFsbCBhbmQgZW5hYmxlIHRoZSBwbHVn
aW4uPC9wPgoKCjxoMiBpZD0idGFncyI+VGFnczwvaDI+Cgo8cHJlPjxjb2RlPiZsdDt0eHA6
amNyX2xpbmtfY3VzdG9tIC8mZ3Q7PC9jb2RlPjwvcHJlPgoKPHA+T3V0cHV0cyB0aGUgY29u
dGVudCBvZiB0aGUgbGluayBjdXN0b20gZmllbGQuPC9wPgoKPGgzPlRhZyBhdHRyaWJ1dGVz
PC9oMz4KCjxwPjxzdHJvbmc+ZXNjYXBlPC9zdHJvbmc+PGJyIC8+CkVzY2FwZSA8c3BhbiBj
bGFzcz0iY2FwcyI+SFRNTDwvc3Bhbj4gZW50aXRpZXMgc3VjaCBhcyA8Y29kZT4mbHQ7PC9j
b2RlPiwgPGNvZGU+Jmd0OzwvY29kZT4gYW5kIDxjb2RlPiZhbXA7PC9jb2RlPiBwcmlvciB0
byBlY2hvaW5nIHRoZSBmaWVsZCBjb250ZW50cy48YnIgLz4KRXhhbXBsZTogVXNlIDxjb2Rl
PmVzY2FwZT0mcXVvdDsmcXVvdDs8L2NvZGU+IHRvIHN1cHByZXNzIGNvbnZlcnNpb24uIERl
ZmF1bHQ6IDxjb2RlPmh0bWw8L2NvZGU+LjwvcD4KCgo8aDIgaWQ9ImV4YW1wbGVzIj5FeGFt
cGxlPC9oMj4KCjxwPlByb2R1Y2UgYSBsaXN0IG9mIGxpbmtlZCBwYXJ0bmVyIGxvZ29zIChm
cm9tIGxpbmsgYXNzaWduZWQgdG8gdGhlIGxpbmsgY2F0ZWdvcnkgJiM4MjIwO3BhcnRuZXJz
JiM4MjIxOyk6PC9wPgoKPHByZT48Y29kZT4mbHQ7dHhwOmxpbmtsaXN0IHdyYXB0YWc9JnF1
b3Q7dWwmcXVvdDsgYnJlYWs9JnF1b3Q7bGkmcXVvdDsgY2F0ZWdvcnk9JnF1b3Q7cGFydG5l
cnMmcXVvdDsmZ3Q7CiAgJmx0O2EgaHJlZj0mcXVvdDsmbHQ7dHhwOmxpbmtfdXJsIC8mZ3Q7
JnF1b3Q7IHRpdGxlPSZxdW90OyZsdDt0eHA6bGlua19uYW1lIC8mZ3Q7JnF1b3Q7Jmd0OyZs
dDt0eHA6aW1hZ2UgaWQ9JiMzOTsmbHQ7dHhwOmpjcl9saW5rX2N1c3RvbSAvJmd0OyYjMzk7
IC8mZ3Q7Jmx0Oy9hJmd0OwombHQ7L3R4cDpsaW5rbGlzdCZndDs8L2NvZGU+PC9wcmU+Cgo8
cD53aGVuIHRoZSBsaW5rIGN1c3RvbSBmaWVsZCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBJbWFn
ZSBJRCMgb2YgdGhlIGxvZ28uPC9wPgoKCjxoMj5DaGFuZ2luZyB0aGUgbGFiZWwgb2YgdGhl
IGN1c3RvbSBmaWVsZDwvaDI+Cgo8cD5UaGUgbmFtZSBvZiBjdXN0b20gZmllbGQgY2FuIGJl
IGNoYW5nZWQgYnkgc3BlY2lmeWluZyBhIG5ldyBsYWJlbCB1c2luZyB0aGUgPGVtPkluc3Rh
bGwgZnJvbSBUZXh0cGFjazwvZW0+IGZpZWxkIGluIHRoZSA8YSBocmVmPSJodHRwOi8vZG9j
cy50ZXh0cGF0dGVybi5pby9hZG1pbmlzdHJhdGlvbi9sYW5ndWFnZXMtcGFuZWwiPkFkbWlu
IOKAuiBMYW5ndWFnZXM8L2E+IHBhbmVsLiBFbnRlciB5b3VyIG93biBpbmZvcm1hdGlvbiBp
biB0aGUgZm9sbG93aW5nIHBhdHRlcm4gYW5kIGNsaWNrIDxzdHJvbmc+VXBsb2FkPC9zdHJv
bmc+OjwvcD4KCjxwcmU+PGNvZGU+I0BhZG1pbgojQGxhbmd1YWdlIGVuLWdiCmpjcl9saW5r
X2N1c3RvbSA9Jmd0OyBZb3VyIGxhYmVsPC9jb2RlPjwvcHJlPgoKPHA+cmVwbGFjaW5nIDxj
b2RlPmVuLWdiPC9jb2RlPiB3aXRoIHlvdXIgb3duIGxhbmd1YWdlIGFuZCA8Y29kZT5Zb3Vy
IGxhYmVsPC9jb2RlPiB3aXRoIHlvdXIgb3duIGRlc2lyZWQgbGFiZWwuPC9wPgoKCjxoMiBp
ZD0iZGVpbnN0YWxsYXRpb24iPkRlLWluc3RhbGxhdGlvbjwvaDI+Cgo8cD5UaGUgcGx1Z2lu
IGNsZWFucyB1cCBhZnRlciBpdHNlbGY6IGRlaW5zdGFsbGluZyB0aGUgcGx1Z2luIHJlbW92
ZXMgdGhlIGV4dHJhIGNvbHVtbiBmcm9tIHRoZSBkYXRhYmFzZS4gVG8gc3RvcCB1c2luZyB0
aGUgcGx1Z2luIGJ1dCBrZWVwIHRoZSBkYXRhYmFzZSB0YWJsZXMsIGp1c3QgZGlzYWJsZSAo
ZGVhY3RpdmF0ZSkgdGhlIHBsdWdpbiBidXQgZG9uJiM4MjE3O3QgZGVsZXRlIGl0LjwvcD4K
Cgo8aDIgaWQ9ImNoYW5nZWxvZyI+Q2hhbmdlbG9nPC9oMj4KCjxoMz5WZXJzaW9uIDAuMSDi
gJMgMjAxNi8wMy8wNDwvaDM+Cgo8dWw+Cgk8bGk+Rmlyc3QgcmVsZWFzZTwvbGk+CjwvdWw+
CgoKPGgyIGlkPSJjcmVkaXRzIj5DcmVkaXRzPC9oMj4KCjxwPlJvYmVydCBXZXR6bG1heXLi
gJlzIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9yd2V0emxtYXlyL3dldF9wcm9maWxl
Ij53ZXRfcHJvZmlsZTwvYT4gcGx1Z2luIGZvciB0aGUgc3RhcnRpbmcgcG9pbnQsIGFuZCBm
dXJ0aGVyIGV4YW1wbGVzIGJ5IDxhIGhyZWY9Imh0dHA6Ly93d3cuc3RlZmRhd3Nvbi5jb20i
PlN0ZWYgRGF3c29uPC9hPiBhbmQgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2dvY29t
Ij5KdWtrYSBTdmFobjwvYT4uPC9wPiI7czozOiJjc3MiO3M6MDoiIjtzOjQ6ImNvZGUiO3M6
MjY3NjoiY2xhc3MgamNyX2xpbmtfY3VzdG9tCnsKCS8qKgoJICogSW5pdGlhbGlzZS4KCSAq
LwoJIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkKCXsKCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJh
eShfX0NMQVNTX18sICdsaWZlY3ljbGUnKSwgJ3BsdWdpbl9saWZlY3ljbGUuamNyX2xpbmtf
Y3VzdG9tJyk7CgkJcmVnaXN0ZXJfY2FsbGJhY2soYXJyYXkoX19DTEFTU19fLCAndWknKSwg
J2xpbmtfdWknLCAnZXh0ZW5kX2RldGFpbF9mb3JtJyk7CgkJcmVnaXN0ZXJfY2FsbGJhY2so
YXJyYXkoX19DTEFTU19fLCAnc2F2ZScpLCAnbGluaycsICdsaW5rX3NhdmUnKTsKCX0KCiAg
LyoqCiAgICogQWRkIGFuZCByZW1vdmUgY3VzdG9tIGZpZWxkIGZyb20gdHhwX2xpbmsgdGFi
bGUuCiAgICoKICAgKiBAcGFyYW0gJGV2ZW50IHN0cmluZwogICAqIEBwYXJhbSAkc3RlcCBz
dHJpbmcgIFRoZSBsaWZlY3ljbGUgcGhhc2Ugb2YgdGhpcyBwbHVnaW4KICAgKi8KICBwdWJs
aWMgc3RhdGljIGZ1bmN0aW9uIGxpZmVjeWNsZSgkZXZlbnQsICRzdGVwKQogIHsKICAgICAg
c3dpdGNoICgkc3RlcCkgewogICAgICAgICAgY2FzZSAnZW5hYmxlZCc6CiAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6CiAgICAgICAgICAgICAgYnJl
YWs7CiAgICAgICAgICBjYXNlICdpbnN0YWxsZWQnOgogICAgICAgICAgICAgIHNhZmVfYWx0
ZXIoCiAgICAgICAgICAgICAgICAndHhwX2xpbmsnLAogICAgICAgICAgICAgICAgJ0FERCBD
T0xVTU4gamNyX2xpbmtfY3VzdG9tIFZBUkNIQVIoMjU1KSBOVUxMIEFGVEVSIGF1dGhvcicK
ICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAn
ZGVsZXRlZCc6CiAgICAgICAgICAgICAgc2FmZV9hbHRlcigKICAgICAgICAgICAgICAgICd0
eHBfbGluaycsCiAgICAgICAgICAgICAgICAnRFJPUCBDT0xVTU4gamNyX2xpbmtfY3VzdG9t
JwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAg
cmV0dXJuOwogIH0KCgkvKioKCSAqIFBhaW50IGFkZGl0aW9uYWwgZmllbGRzIGZvciBsaW5r
IGN1c3RvbSBmaWVsZAoJICoKCSAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCgkgKiBAcGFyYW0g
JHN0ZXAgc3RyaW5nCgkgKiBAcGFyYW0gJGR1bW15IHN0cmluZwoJICogQHBhcmFtICRycyBh
cnJheSBUaGUgY3VycmVudCBsaW5rJ3MgZGF0YQoJICogQHJldHVybiBzdHJpbmcKCSAqLwoJ
cHVibGljIHN0YXRpYyBmdW5jdGlvbiB1aSgkZXZlbnQsICRzdGVwLCAkZHVtbXksICRycykK
CXsKCQlleHRyYWN0KGxBdHRzKGFycmF5KAoJCQknamNyX2xpbmtfY3VzdG9tJyA9PiAnJwoJ
CSksICRycywgMCkpOwoKCQlyZXR1cm4KCQkJaW5wdXRMYWJlbCgnamNyX2xpbmtfY3VzdG9t
JywgZklucHV0KCd0ZXh0JywgJ2pjcl9saW5rX2N1c3RvbScsICRqY3JfbGlua19jdXN0b20s
ICcnLCAnJywgJycsIElOUFVUX1JFR1VMQVIsICcnLCAnamNyX2xpbmtfY3VzdG9tJyksICdq
Y3JfbGlua19jdXN0b20nKS5uOwoJfQoKCS8qKgoJICogU2F2ZSBhZGRpdGlvbmFsIGxpbmsg
Y3VzdG9tIGZpZWxkcwoJICoKCSAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCgkgKiBAcGFyYW0g
JHN0ZXAgc3RyaW5nCgkgKi8KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc2F2ZSgkZXZlbnQs
ICRzdGVwKQoJewoJCWV4dHJhY3QoZG9TbGFzaChwc2EoYXJyYXkoJ2pjcl9saW5rX2N1c3Rv
bScsICdpZCcpKSkpOwoJCSRpZCA9IGFzc2VydF9pbnQoJGlkKTsKCQlzYWZlX3VwZGF0ZSgn
dHhwX2xpbmsnLAoJCSAgImpjcl9saW5rX2N1c3RvbSA9ICckamNyX2xpbmtfY3VzdG9tJyIs
CgkJCSJpZCA9ICRpZCIKCQkpOwoJfQp9CgppZiAodHhwaW50ZXJmYWNlID09PSAnYWRtaW4n
KSB7CgogICAgbmV3IGpjcl9saW5rX2N1c3RvbTsKCn0gZWxzZWlmICh0eHBpbnRlcmZhY2Ug
PT09ICdwdWJsaWMnKSB7CgogICAgaWYgKGNsYXNzX2V4aXN0cygnXFRleHRwYXR0ZXJuXFRh
Z1xSZWdpc3RyeScpKSB7CiAgICAgICAgVHhwOjpnZXQoJ1xUZXh0cGF0dGVyblxUYWdcUmVn
aXN0cnknKQogICAgICAgICAgICAtPnJlZ2lzdGVyKCdqY3JfbGlua19jdXN0b20nKTsKICAg
IH0KCn0KCiAgLyoqCiAgICogUHVibGljIHRhZzogT3V0cHV0IGN1c3RvbSBsaW5rIGZpZWxk
CiAgICogQHBhcmFtICBzdHJpbmcgJGF0dHNbZXNjYXBlXSBDb252ZXJ0IHNwZWNpYWwgY2hh
cmFjdGVycyB0byBIVE1MIGVudGl0aWVzLgogICAqIEByZXR1cm4gc3RyaW5nICBjdXN0b20g
ZmllbGQgb3V0cHV0CiAgICogPGNvZGU+CiAgICogICAgICAgIDx0eHA6amNyX2xpbmtfY3Vz
dG9tIGVzY2FwZT0iaHRtbCIgLz4KICAgKiA8L2NvZGU+CiAgICovCgogICAgZnVuY3Rpb24g
amNyX2xpbmtfY3VzdG9tKCRhdHRzKQogICAgewogICAgICAgIGdsb2JhbCAkdGhpc2xpbms7
CgogICAgICAgIGFzc2VydF9saW5rKCk7CgogICAgICAgIGV4dHJhY3QobEF0dHMoYXJyYXko
CiAgICAgICAgICAgICdlc2NhcGUnID0+ICdodG1sJywKICAgICAgICApLCAkYXR0cykpOwoK
ICAgICAgICByZXR1cm4gKCRlc2NhcGUgPT0gJ2h0bWwnKQogICAgICAgICAgICA/IHR4cHNw
ZWNpYWxjaGFycygkdGhpc2xpbmtbJ2pjcl9saW5rX2N1c3RvbSddKQogICAgICAgICAgICA6
ICR0aGlzbGlua1snamNyX2xpbmtfY3VzdG9tJ107CiAgICB9IjtzOjM6Im1kNSI7czozMjoi
NmE0MDhlZDBhOGZlODBhNGIzY2Y1YTI4YjllZDA4YjQiO30=
